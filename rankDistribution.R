df.plot %>% group_by(state,county,sampleIndex) %>% arrange(desc(n)) %>% mutate(rank = 1:n()) %>% group_by(state,county,key,rank) %>% summarize(n = n()) %>% ungroup() %>%  arrange(rank) %>% filter(key %in% c("Smartphone Only","DT/LT only","Only an “other”","Only a tablet")) %>% pivot_wider(names_from = key,names_sep = "n.",values_from = n) %>% mutate(rank = factor(rank,levels = 1L:16L,ordered = TRUE)) %>% complete(rank) %>% fill(state,county,.direction = "downup")